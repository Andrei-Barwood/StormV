<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Detecci贸n de Micror谩fagas - Aviation Safety</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <path d="M16 2L4 10v12l12 8 12-8V10L16 2z" fill="#0047AB" stroke="#32B8CD" stroke-width="2"/>
                        <circle cx="16" cy="16" r="4" fill="#32B8CD"/>
                    </svg>
                </div>
                <div class="header-title">
                    <h1>Sistema de Detecci贸n de Micror谩fagas</h1>
                    <p class="subtitle">Aviation Weather Monitoring System</p>
                </div>
            </div>
            <div class="header-right">
                <div class="system-time" id="systemTime"></div>
                <div class="system-status" id="systemStatus">
                    <span class="status-indicator"></span>
                    <span class="status-text">OPERACIONAL</span>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="main-nav">
            <button class="nav-btn active" data-view="monitoring">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                </svg>
                Monitoreo en Tiempo Real
            </button>
            <button class="nav-btn" data-view="sensors">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20M2 12h20M6 6l12 12M18 6L6 18"/>
                </svg>
                An谩lisis de Sensores
            </button>
            <button class="nav-btn" data-view="history">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
                Historial y Estad铆sticas
            </button>
            <button class="nav-btn" data-view="settings">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v6m0 6v6M23 12h-6m-6 0H1m18.36-7.36l-4.24 4.24m-6.36 6.36L4.64 19.36M23 20.36l-4.24-4.24m-6.36-6.36L8.16 5.52"/>
                </svg>
                Configuraci贸n
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- View 1: Real-Time Monitoring Dashboard -->
            <div id="monitoringView" class="view active">
                <div class="monitoring-layout">
                    <!-- Left Panel - Map -->
                    <div class="left-panel">
                        <div class="card map-card">
                            <div class="card-header">
                                <h2>Mapa de Detecci贸n</h2>
                                <span class="update-time" id="mapUpdateTime">Actualizado hace 0s</span>
                            </div>
                            <div id="map" class="map-container"></div>
                        </div>
                        <div class="card weather-metrics">
                            <div class="metric">
                                <span class="metric-label">Temperatura</span>
                                <span class="metric-value" id="tempValue">--掳C</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Presi贸n</span>
                                <span class="metric-value" id="pressureValue">-- hPa</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Viento</span>
                                <span class="metric-value" id="windValue">-- m/s</span>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel - Charts and Alerts -->
                    <div class="right-panel">
<!-- Continental Filter -->
<div class="continent-filter-card" style="background: var(--color-surface); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
  <label for="continentFilter" style="display: block; font-weight: 600; color: var(--color-primary); margin-bottom: 0.5rem;">
     Filter Alerts by Continent
  </label>
  <select id="continentFilter" class="form-control" style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-background);">
    <option value="all" selected> All Continents</option>
    <option value="America"> America</option>
    <option value="Europe"> Europe</option>
    <option value="Asia"> Asia</option>
    <option value="Africa"> Africa</option>
    <option value="Oceania"> Oceania</option>
    <option value="Antarctica">锔 Antarctica</option>
  </select>
</div>

                        <!-- Active Alerts -->
                        <div class="card alerts-card">
                            <div class="card-header">
                                <h2>Alertas Activas</h2>
                            </div>
                            <div class="alerts-content" id="alertsContent">
                                <div class="alert-summary">
                                    <div class="alert-count">
                                        <span class="count-number" id="alertCount">0</span>
                                        <span class="count-label">Detecciones Activas</span>
                                    </div>
                                </div>
                                <div id="criticalAlert" class="critical-alert-display"></div>
                            </div>
                        </div>

                        <!-- Reflectivity & Velocity Chart -->
                        <div class="card chart-card">
                            <div class="card-header">
                                <h2>Reflectividad y Velocidad Radial</h2>
                            </div>
                            <div class="chart-container">
                                <canvas id="reflectivityChart"></canvas>
                            </div>
                        </div>

                        <!-- Wind Shear Chart -->
                        <div class="card chart-card">
                            <div class="card-header">
                                <h2>Magnitud de Cizalladura del Viento</h2>
                            </div>
                            <div class="chart-container">
                                <canvas id="windShearChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View 2: Sensor Data Analysis -->
            <div id="sensorsView" class="view">
                <div class="sensor-tabs">
                    <button class="tab-btn active" data-sensor="lidar">LIDAR</button>
                    <button class="tab-btn" data-sensor="radar">Radar</button>
                    <button class="tab-btn" data-sensor="anemometer">Anem贸metro</button>
                    <button class="tab-btn" data-sensor="fusion">Fusi贸n de Sensores</button>
                </div>

                <div class="sensor-content">
                    <!-- LIDAR Tab -->
                    <div id="lidarTab" class="sensor-tab active">
                        <div class="sensor-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Perfil de Velocidad Vertical</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="lidarVelocityChart"></canvas>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>Intensidad de Retrodispersi贸n</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="lidarBackscatterChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-stats">
                            <div class="stat-card">
                                <span class="stat-label">Velocidad M铆n</span>
                                <span class="stat-value" id="lidarMinVel">-- m/s</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Velocidad M谩x</span>
                                <span class="stat-value" id="lidarMaxVel">-- m/s</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Calidad de Datos</span>
                                <span class="stat-value" id="lidarQuality">--%</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">ltima Actualizaci贸n</span>
                                <span class="stat-value" id="lidarLastUpdate">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Radar Tab -->
                    <div id="radarTab" class="sensor-tab">
                        <div class="sensor-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Reflectividad Doppler</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="radarReflectivityChart"></canvas>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>Ancho Espectral</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="radarSpectrumChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-stats">
                            <div class="stat-card">
                                <span class="stat-label">Reflectividad</span>
                                <span class="stat-value" id="radarReflectivity">-- dBZ</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Velocidad Radial</span>
                                <span class="stat-value" id="radarVelocity">-- m/s</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Calidad de Datos</span>
                                <span class="stat-value" id="radarQuality">--%</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">ltima Actualizaci贸n</span>
                                <span class="stat-value" id="radarLastUpdate">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Anemometer Tab -->
                    <div id="anemometerTab" class="sensor-tab">
                        <div class="sensor-grid">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Velocidad del Viento</h3>
                                </div>
                                <div class="chart-container">
                                    <canvas id="anemometerWindChart"></canvas>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>Direcci贸n del Viento</h3>
                                </div>
                                <div class="wind-compass" id="windCompass">
                                    <div class="compass-arrow" id="compassArrow"></div>
                                    <div class="compass-label n">N</div>
                                    <div class="compass-label e">E</div>
                                    <div class="compass-label s">S</div>
                                    <div class="compass-label w">O</div>
                                </div>
                            </div>
                        </div>
                        <div class="sensor-stats">
                            <div class="stat-card">
                                <span class="stat-label">Velocidad</span>
                                <span class="stat-value" id="anemometerSpeed">-- m/s</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Direcci贸n</span>
                                <span class="stat-value" id="anemometerDirection">--掳</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">Calidad de Datos</span>
                                <span class="stat-value" id="anemometerQuality">--%</span>
                            </div>
                            <div class="stat-card">
                                <span class="stat-label">ltima Actualizaci贸n</span>
                                <span class="stat-value" id="anemometerLastUpdate">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Fusion Tab -->
                    <div id="fusionTab" class="sensor-tab">
                        <div class="fusion-grid">
                            <div class="card fusion-confidence">
                                <div class="card-header">
                                    <h3>Confianza de Fusi贸n</h3>
                                </div>
                                <div class="confidence-display">
                                    <div class="confidence-circle" id="fusionConfidence">
                                        <span class="confidence-value">--%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>Estado del Filtro Kalman</h3>
                                </div>
                                <div class="kalman-state" id="kalmanState">
                                    <div class="kalman-param">
                                        <span>Posici贸n X:</span>
                                        <span id="kalmanX">--</span>
                                    </div>
                                    <div class="kalman-param">
                                        <span>Posici贸n Y:</span>
                                        <span id="kalmanY">--</span>
                                    </div>
                                    <div class="kalman-param">
                                        <span>Velocidad:</span>
                                        <span id="kalmanV">--</span>
                                    </div>
                                    <div class="kalman-param">
                                        <span>Aceleraci贸n:</span>
                                        <span id="kalmanA">--</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card fusion-sources">
                                <div class="card-header">
                                    <h3>Fuentes de Datos Activas</h3>
                                </div>
                                <div class="source-list">
                                    <div class="source-item">
                                        <span class="source-name">LIDAR</span>
                                        <div class="source-status active">Activo</div>
                                        <span class="source-weight" id="lidarWeight">35%</span>
                                    </div>
                                    <div class="source-item">
                                        <span class="source-name">Radar Doppler</span>
                                        <div class="source-status active">Activo</div>
                                        <span class="source-weight" id="radarWeight">45%</span>
                                    </div>
                                    <div class="source-item">
                                        <span class="source-name">Anem贸metro</span>
                                        <div class="source-status active">Activo</div>
                                        <span class="source-weight" id="anemometerWeight">20%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View 3: Detection History & Statistics -->
            <div id="historyView" class="view">
                <div class="history-header">
                    <h2>Historial de Detecciones - ltimas 24 Horas</h2>
                    <div class="filter-controls">
                        <select id="severityFilter" class="form-control">
                            <option value="all">Todas las Severidades</option>
                            <option value="LOW">Baja</option>
                            <option value="MODERATE">Moderada</option>
                            <option value="SEVERE">Severa</option>
                            <option value="EXTREME">Extrema</option>
                        </select>
                    </div>
                </div>

                <div class="history-charts">
                    <div class="card">
                        <div class="card-header">
                            <h3>L铆nea de Tiempo de Detecciones</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Distribuci贸n por Severidad</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="severityChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card detection-table-card">
                    <div class="card-header">
                        <h3>Tabla de Detecciones</h3>
                    </div>
                    <div class="table-container">
                        <table class="detection-table">
                            <thead>
                                <tr>
                                    <th>ID Detecci贸n</th>
                                    <th>Timestamp</th>
                                    <th>Severidad</th>
                                    <th>Confianza</th>
                                    <th>Duraci贸n</th>
                                    <th>Cizalladura M谩x</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="detectionTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- View 4: Settings & Configuration -->
            <div id="settingsView" class="view">
                <div class="settings-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Configuraci贸n de API</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Endpoint de API</label>
                            <input type="text" class="form-control" id="apiEndpoint" value="https://api.aviation-weather.com/v1/microburst">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Estado de Conexi贸n</label>
                            <div class="connection-status">
                                <span class="status-indicator connected"></span>
                                <span>Conectado</span>
                            </div>
                        </div>
                        <button class="btn btn--primary" id="testConnectionBtn">Probar Conexi贸n</button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Umbrales de Alerta</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cizalladura del Viento (m/s): <span id="windShearThresholdValue">6</span></label>
                            <input type="range" class="slider" id="windShearThreshold" min="0" max="15" value="6" step="0.5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reflectividad (dBZ): <span id="reflectivityThresholdValue">60</span></label>
                            <input type="range" class="slider" id="reflectivityThreshold" min="0" max="80" value="60" step="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confianza M铆nima (%): <span id="confidenceThresholdValue">85</span></label>
                            <input type="range" class="slider" id="confidenceThreshold" min="0" max="100" value="85" step="1">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Opciones de Visualizaci贸n</h3>
                        </div>
                        <div class="form-group toggle-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="showSensors" checked>
                                <span class="toggle-switch"></span>
                                Mostrar capas de sensores en el mapa
                            </label>
                        </div>
                        <div class="form-group toggle-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="showWindVectors" checked>
                                <span class="toggle-switch"></span>
                                Mostrar vectores de viento
                            </label>
                        </div>
                        <div class="form-group toggle-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="soundAlerts" checked>
                                <span class="toggle-switch"></span>
                                Alertas sonoras habilitadas
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Volumen de Alerta: <span id="volumeValue">70</span>%</label>
                            <input type="range" class="slider" id="volumeSlider" min="0" max="100" value="70" step="1">
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Exportaci贸n de Datos</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rango de Fechas</label>
                            <input type="date" class="form-control" id="exportStartDate">
                            <input type="date" class="form-control" id="exportEndDate" style="margin-top: 8px;">
                        </div>
                        <div class="export-buttons">
                            <button class="btn btn--secondary" id="exportCSV">Exportar a CSV</button>
                            <button class="btn btn--secondary" id="exportJSON">Exportar a JSON</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Detection Detail Modal -->
    <div id="detectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detalles de la Detecci贸n</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
</body>
</html>